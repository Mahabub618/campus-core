-- Users & Roles
CREATE TABLE users (
    id UUID PRIMARY KEY,
    email VARCHAR(255) UNIQUE,
    phone VARCHAR(20),
    password_hash VARCHAR(255),
    role VARCHAR(50), -- 'SUPER_ADMIN', 'ADMIN', 'TEACHER', 'STUDENT', 'PARENT', 'ACCOUNTANT'
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

CREATE TABLE user_profiles (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    first_name VARCHAR(100),
    last_name VARCHAR(100),
    date_of_birth DATE,
    gender VARCHAR(10),
    address TEXT,
    profile_image_url VARCHAR(500),
    -- Role-specific fields (nullable)
    employee_id VARCHAR(50), -- For teachers, accountants, admins
    admission_number VARCHAR(50), -- For students
    occupation VARCHAR(100), -- For parents
    -- School relation
    school_id UUID REFERENCES schools(id),
    created_at TIMESTAMP
);

-- Role-specific tables
CREATE TABLE teachers (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    qualifications TEXT[],
    subjects_taught UUID[] REFERENCES subjects(id),
    joining_date DATE,
    department_id UUID REFERENCES departments(id)
);

CREATE TABLE students (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    parent_id UUID REFERENCES parents(id),
    class_id UUID REFERENCES classes(id),
    section_id UUID REFERENCES sections(id),
    roll_number INTEGER,
    admission_date DATE,
    blood_group VARCHAR(5),
    medical_info TEXT
);

CREATE TABLE parents (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    occupation VARCHAR(100),
    office_address TEXT,
    emergency_contact VARCHAR(20)
);

CREATE TABLE parent_student_relations (
    id UUID PRIMARY KEY,
    parent_id UUID REFERENCES parents(id),
    student_id UUID REFERENCES students(id),
    relationship VARCHAR(50), -- 'Father', 'Mother', 'Guardian'
    is_primary BOOLEAN DEFAULT false
);